# -*- coding: utf-8 -*-
"""airqualitymachinlearning.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Fs_GbZtC-3r9MT5-sIy6Ed2fn3IMk4QL
"""

import pandas as pd
import numpy as np

import pandas as pd
df = pd.read_excel("AirQualityUCI.xlsx", sheet_name="AirQualityUCI")
df.head()

df.isin([-200]).sum(axis=0)

df=df.replace(to_replace=-200,value=np.nan)

df.isnull().sum()

# ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© Ø¨Ø§Ù„Ù…ØªÙˆØ³Ø· ÙÙ‚Ø· Ù„Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
df = df.fillna(df.select_dtypes(include="number").mean())

df.isnull().sum()

# Ø­Ø°Ù Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Date Ùˆ Time Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©
if "Date" in df.columns:
    df = df.drop(columns=["Date"])
if "Time" in df.columns:
    df = df.drop(columns=["Time"])

# Ø§Ù„Ù‡Ø¯Ù (Target)
y = df["CO(GT)"]

# Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø© (Features)
X = df.drop(columns=["CO(GT)"])

print("X shape:", X.shape)
print("y shape:", y.shape)

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.3, random_state=42
)

print("Train:", X_train.shape, y_train.shape)
print("Test:", X_test.shape, y_test.shape)



from sklearn.linear_model import LinearRegression
from sklearn.metrics import r2_score, mean_absolute_error, mean_squared_error
from sklearn.metrics import mean_squared_error

# Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„
model = LinearRegression()
model.fit(X_train, y_train)

# Ø§Ù„ØªÙ†Ø¨Ø¤
y_pred = model.predict(X_test)



# ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
print("LinearRegression()")
print("RÂ²:", r2_score(y_test, y_pred))
print("MAE:", mean_absolute_error(y_test, y_pred))
print("MSE",mean_squared_error(y_test, y_pred))

from sklearn.tree import DecisionTreeRegressor

model = DecisionTreeRegressor(random_state=42)
model.fit(X_train, y_train)
y_pred = model.predict(X_test)

# ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
print("DecisionTreeRegressor")
print("RÂ²:", r2_score(y_test, y_pred))
print("MAE:", mean_absolute_error(y_test, y_pred))
print("MSE",mean_squared_error(y_test, y_pred))

from sklearn.ensemble import RandomForestRegressor

model = RandomForestRegressor(n_estimators=100, random_state=42)
model.fit(X_train, y_train)
y_pred = model.predict(X_test)

# ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
print("RandomForestRegressor")
print("RÂ²:", r2_score(y_test, y_pred))
print("MAE:", mean_absolute_error(y_test, y_pred))
print("MSE",mean_squared_error(y_test, y_pred))

"""Gradient Boosting Regressor (Ø²ÙŠ XGBoost / LightGBM)
Ù‚ÙˆÙŠ Ø¬Ø¯Ø§Ù‹ Ø®ØµÙˆØµØ§Ù‹ Ù„Ùˆ Ø§Ù„Ø¯Ø§ØªØ§ ÙƒØ¨ÙŠØ±Ø© ÙˆÙ…Ø¹Ù‚Ø¯Ø©.
"""

from sklearn.ensemble import GradientBoostingRegressor

model = GradientBoostingRegressor(random_state=42)
model.fit(X_train, y_train)
y_pred = model.predict(X_test)

# ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
print("GradientBoostingRegressor")
print("RÂ²:", r2_score(y_test, y_pred))
print("MAE:", mean_absolute_error(y_test, y_pred))
print("MSE",mean_squared_error(y_test, y_pred))

from sklearn.svm import SVR

model = SVR(kernel='rbf')
model.fit(X_train, y_train)
y_pred = model.predict(X_test)

# ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
print("SVR")
print("RÂ²:", r2_score(y_test, y_pred))
print("MAE:", mean_absolute_error(y_test, y_pred))
print("MSE",mean_squared_error(y_test, y_pred))

from sklearn.linear_model import Ridge, Lasso

model = Ridge(alpha=1.0)
model.fit(X_train, y_train)
y_pred = model.predict(X_test)


# ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
print("Ridge,lasso")
print("RÂ²:", r2_score(y_test, y_pred))
print("MAE:", mean_absolute_error(y_test, y_pred))
print("MSE",mean_squared_error(y_test, y_pred))

import numpy as np
import pandas as pd
from sklearn.metrics import r2_score, mean_absolute_error, mean_squared_error
from sklearn.linear_model import LinearRegression, Ridge, Lasso
from sklearn.tree import DecisionTreeRegressor
from sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor
from sklearn.svm import SVR

# ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª
models = {
    "Linear Regression": LinearRegression(),
    "Ridge Regression": Ridge(alpha=1.0),
    "Lasso Regression": Lasso(alpha=0.01),
    "Decision Tree": DecisionTreeRegressor(random_state=42),
    "Random Forest": RandomForestRegressor(n_estimators=100, random_state=42),
    "Gradient Boosting": GradientBoostingRegressor(random_state=42),
    "SVR": SVR(kernel='rbf')
}

# Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
results = []

# ØªØ¬Ø±Ø¨Ø© ÙƒÙ„ Ù…ÙˆØ¯ÙŠÙ„
for name, model in models.items():
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)

    r2 = r2_score(y_test, y_pred)
    mae = mean_absolute_error(y_test, y_pred)
    mse = mean_squared_error(y_test, y_pred)

    results.append([name, r2, mae, mse])

# ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ø¬Ø¯ÙˆÙ„
results_df = pd.DataFrame(results, columns=["Model", "RÂ²", "MAE", "MSE"])

print(results_df)

from sklearn.ensemble import RandomForestRegressor
import joblib  # Ù„Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„

# ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„
model = RandomForestRegressor(n_estimators=200, max_depth=20, random_state=42)
model.fit(X_train, y_train)

# Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„
joblib.dump(model, "best_model.pkl")

!pip install streamlit
!pip install pyngrok

# Commented out IPython magic to ensure Python compatibility.
# %%writefile app.py
# import streamlit as st
# import joblib
# 
# # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„
# model = joblib.load("best_model.pkl")
# 
# st.title("ğŸŒ Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Random Forest")
# 
# region = st.selectbox("Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:", ["Irbid", "Amman", "Zarqa", "Aqaba"])
# gas = st.selectbox("Ø§Ø®ØªØ± Ø§Ù„ØºØ§Ø²:", ["CO", "NO2", "SO2", "O3", "PM10"])
# 
# value1 = st.number_input("Ø§Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªØºÙŠØ± 1", min_value=0.0, max_value=500.0, value=10.0)
# value2 = st.number_input("Ø§Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªØºÙŠØ± 2", min_value=0.0, max_value=500.0, value=20.0)
# 
# region_map = {"Irbid": 0, "Amman": 1, "Zarqa": 2, "Aqaba": 3}
# gas_map = {"CO": 0, "NO2": 1, "SO2": 2, "O3": 3, "PM10": 4}
# 
# X_new = [[region_map[region], gas_map[gas], value1, value2]]
# 
# if st.button("ØªÙ†Ø¨Ø¤"):
#     prediction = model.predict(X_new)
#     st.success(f"Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: {prediction[0]:.2f}")
#

from pyngrok import ngrok

# ØªØ´ØºÙŠÙ„ streamlit
!streamlit run app.py &

# ÙØªØ­ Ø±Ø§Ø¨Ø· ngrok
url = ngrok.connect(8501)
print("Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:", url)

